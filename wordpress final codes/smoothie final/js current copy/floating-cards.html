<script type="text/javascript">
  (function () {
    // ! GLOBALS (scoped inside IIFE, wonâ€™t leak)
    let vw = window.innerWidth;
    let vh = window.innerHeight;
    let windowX = window.innerWidth;
    let windowY = window.innerHeight;
    let mouseX = 0,
      mouseY = 0;

    let fc_splitInstances = [];

    // ! SPLIT TEXT
    function splitFloatingCardsText() {
      fc_splitInstances.forEach((inst) => inst.revert());
      fc_splitInstances = [];

      fc_splitInstances.push(
        new SplitType("#floating-cards-section h1, #floating-cards-section p", {
          types: "lines, words",
        })
      );
    }

    // ! INIT
    function init() {
      if (!document.querySelector("#floating-cards-section")) return;

      // copy text content
      const fc_section2_h1 = document.querySelector(
        ".floating-cards-text-container-2 h1"
      );
      const fc_section2_p_container = document.querySelector(
        ".floating-cards-text-container-2 .paragraph-text-container"
      );
      const fc_section2_text_h1 = document.querySelector(
        ".floating-card-text-2-content h1"
      );
      const fc_section2_text_p_container = document.querySelector(
        ".floating-card-text-2-content .paragraph-text-container"
      );

      if (fc_section2_h1 && fc_section2_text_h1) {
        fc_section2_h1.innerHTML = fc_section2_text_h1.innerHTML;
      }
      if (fc_section2_p_container && fc_section2_text_p_container) {
        fc_section2_p_container.innerHTML =
          fc_section2_text_p_container.innerHTML;
      }

      gsap.registerPlugin(ScrollTrigger);

      // split before animations
      splitFloatingCardsText();

      let mm = gsap.matchMedia();
      mm.add("(max-width: 768px)", () => {
        buildTimelines("-15vw", "10vh", "top top-=250%");
      });
      mm.add("(min-width: 769px)", () => {
        buildTimelines("-55vw", "18vh", "top top-=350%");
      });

      ScrollTrigger.refresh();

      window.addEventListener("resize", onWindowResize, false);
      window.addEventListener("mousemove", onMouseMove);
    }

    // ! TIMELINES
    function buildTimelines(stickyCardFinalX, stickyCardFinalY, stEnd) {
      // intro
      let tl = gsap.timeline({
        scrollTrigger: {
          trigger: "#floating-cards-section",
          start: "top bottom",
          end: "bottom bottom-=50%",
          scrub: 0.5,
          anticipatePin: 1,
        },
        defaults: { ease: "power2.in" },
      });

      tl.from(".floating-card", {
        z: "-5vw",
        opacity: 0,
        stagger: 0.01,
        onStart: () => {
          document
            .getElementById("floating-card-sticky")
            ?.classList.add("fc-far");
        },
      })
        .from(".floating-cards-scene", { y: "50vh" }, "<")
        .from(
          ".floating-cards-text-container-1 h1 .word",
          { opacity: 0, yPercent: 100, stagger: 0.05 },
          "<+=75%"
        )
        .from(
          ".floating-cards-text-container-1 .btn-grad",
          {
            opacity: 0,
            yPercent: 100,
          },
          ">"
        );

      // scroll/pin
      let st = gsap.timeline({
        scrollTrigger: {
          trigger: "#floating-cards-section",
          start: "top top",
          end: stEnd,
          scrub: 0.5,
          pin: "#floating-cards-section",
        },
      });

      st.set(".floating-card", {
        opacity: 1,
        onUpdate: () => {
          document
            .getElementById("floating-card-sticky")
            ?.classList.add("fc-far");
        },
      })
        .to(".floating-card", { opacity: 0.1, duration: 1, delay: 1 })
        .to(".floating-cards-text-container-1", { opacity: 0.1 }, "<")
        .to(
          ".floating-card-sticky",
          {
            scale: 1.1,
            opacity: 1,
            duration: 1,
            onStart: () => {
              document
                .getElementById("floating-card-sticky")
                ?.classList.remove("fc-far");
            },
          },
          "<"
        )
        .to(".floating-card", { opacity: 0, y: "-10vh", duration: 1 })
        .to(
          ".floating-cards-text-container-1",
          { opacity: 0, duration: 1 },
          "<"
        )
        .to(
          ".floating-card-sticky",
          {
            scale: 2,
            x: stickyCardFinalX,
            y: stickyCardFinalY,
            duration: 1,
          },
          "<"
        )
        .set(".floating-cards-text-container-2 h1 .word", {
          opacity: 0,
          yPercent: 80,
        })
        .set(".floating-cards-text-container-2 p .line", {
          opacity: 0,
          yPercent: 80,
        })
        .set(".floating-cards-text-container-2 .elementor-widget-button", {
          opacity: 0,
          yPercent: 80,
        })
        .to(".floating-cards-text-container-2 h1 .word", {
          opacity: 1,
          yPercent: 0,
          stagger: 0.05,
        })
        .to(".floating-cards-text-container-2 p .line", {
          opacity: 1,
          yPercent: 0,
          stagger: 0.05,
        })
        .to(".floating-cards-text-container-2 .elementor-widget-button", {
          opacity: 1,
          yPercent: 0,
          stagger: 0.05,
        });
    }

    // ! MOUSE MOVE
    function onMouseMove(e) {
      let dis = 80;
      mouseX = (e.clientX / windowX) * dis - dis / 2;
      mouseY = (e.clientY / windowY) * dis - dis / 2;

      gsap.to(".fc-near", {
        duration: 1,
        x: mouseX,
        y: mouseY,
        ease: "power2.out",
      });
      gsap.to(".fc-far", {
        duration: 1,
        x: mouseX * 0.75,
        y: mouseY * 0.75,
        ease: "power2.out",
      });
    }

    // ! RESIZE
    function onWindowResize() {
      vw = window.innerWidth;
      vh = window.innerHeight;
      windowX = vw;
      windowY = vh;

      splitFloatingCardsText();
      ScrollTrigger.refresh();
    }

    // single init
    document.addEventListener("DOMContentLoaded", init);
    // document.addEventListener("DOMContentLoaded", () => {
    //   document.fonts.ready.then(init);
    // });
  })();
</script>
